<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expenses Table</title>
    <style>
        body {
            font-family: sans-serif;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th,
        td {
            border: 1px solid black;
            padding: 5px;
        }

        .past {
            background-color: green;
        }

        .upcoming {
            background-color: red;
        }

        .total {
            font-weight: bold;
        }

        .month-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
        }

        .month-nav button {
            margin: 0 10px;
            padding: 5px 10px;
            cursor: pointer;
        }

        .location-button {
            background-color: #eee;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
        }

        .location-button.active {
            background-color: #ccf;
            border: 1px solid #99f;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>Expenses Table</h1>

    <div class="month-nav">
        <button id="at-button" class="location-button active">Austria</button>
        <button id="bh-button" class="location-button">Bosnia</button>
        <button id="prev-month">Previous</button>
        <h2 id="current-month"></h2>
        <button id="next-month">Next</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>Day</th>
                <th>Expense</th>
                <th>Price</th>
            </tr>
        </thead>
        <tbody id="expenses-table-body">
            <!-- Expenses will be added here -->
        </tbody>
        <tfoot>
            <tr>
                <td class="total" colspan="2">Total remaining expenses:</td>
                <td class="total" id="total-remaining-expenses"></td>
            </tr>
        </tfoot>
    </table>

    <script>
        let currentDisplayedDate = new Date();
        let currentExpensesFile = 'at_expenses.json'; // Default to Austria

        async function loadExpenses(filename) {
            const response = await fetch(filename);
            const data = await response.json();
            return data.expenses;
        }

        function isExpenseVisible(expense, currentDate) {
            const currentMonth = currentDate.getMonth();

            if (expense.month === "all") {
                return true;
            }

            if (expense.month === "quarterly") {
                return currentMonth === 2 || currentMonth === 5 || currentMonth === 8 || currentMonth === 11;
            }

            if (expense.month === "february") {
                return currentMonth === 1;
            }

            return false;
        }

        function createExpenseRow(expense, currentDate) {
            const row = document.createElement('tr');
            const dayCell = document.createElement('td');
            const expenseCell = document.createElement('td');
            const priceCell = document.createElement('td');

            dayCell.textContent = expense.day;
            expenseCell.textContent = expense.expense;
            priceCell.textContent = expense.price;

            row.appendChild(dayCell);
            row.appendChild(expenseCell);
            row.appendChild(priceCell);

            const expenseDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), expense.day);
            const todayDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate());
            if (expenseDate <= todayDate) {
                row.classList.add('past');
            } else {
                row.classList.add('upcoming');
            }

            return row;
        }

        function calculateTotalRemainingExpenses(expenses, currentDate) {
            let totalRemainingExpenses = 0;
            const todayDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate());

            for (const expense of expenses) {
                if (isExpenseVisible(expense, currentDate)) {
                    const expenseDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), expense.day);

                    if (expenseDate > todayDate) {
                        totalRemainingExpenses += expense.price;
                    }
                }
            }
            return totalRemainingExpenses;
        }

        function updateCurrentMonthDisplay(date) {
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];
            const currentMonthDisplay = document.getElementById('current-month');
            currentMonthDisplay.textContent = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;
        }

        async function updateExpensesTable(date) {
            const expenses = await loadExpenses(currentExpensesFile);
            const tableBody = document.getElementById('expenses-table-body');
            tableBody.innerHTML = '';

            const filteredExpenses = expenses.filter(expense => {
                const expenseMonth = expense.month;
                if (expenseMonth === "all" || expenseMonth === "quarterly") {
                    return isExpenseVisible(expense, date);
                }
                const expenseMonthIndex = new Date(Date.parse(expenseMonth + " 1, 2023")).getMonth();
                return date.getMonth() === expenseMonthIndex;
            });

            for (const expense of filteredExpenses) {
                const row = createExpenseRow(expense, date);
                tableBody.appendChild(row);
            }

            const totalRemaining = calculateTotalRemainingExpenses(filteredExpenses, date);
            document.getElementById('total-remaining-expenses').textContent = totalRemaining;
        }

        function navigateToPreviousMonth() {
            currentDisplayedDate.setMonth(currentDisplayedDate.getMonth() - 1);
            updateExpensesTable(currentDisplayedDate);
            updateCurrentMonthDisplay(currentDisplayedDate);
        }

        function navigateToNextMonth() {
            currentDisplayedDate.setMonth(currentDisplayedDate.getMonth() + 1);
            updateExpensesTable(currentDisplayedDate);
            updateCurrentMonthDisplay(currentDisplayedDate);
        }

        function toggleLocationButton(buttonId) {
          const atButton = document.getElementById('at-button');
          const bhButton = document.getElementById('bh-button');

          if(buttonId === "at-button"){
            atButton.classList.add('active');
            bhButton.classList.remove('active');
          }
          else{
            bhButton.classList.add('active');
            atButton.classList.remove('active');
          }
        }

        // Event Listeners
        document.getElementById('prev-month').addEventListener('click', navigateToPreviousMonth);
        document.getElementById('next-month').addEventListener('click', navigateToNextMonth);

        document.getElementById('at-button').addEventListener('click', () => {
            currentExpensesFile = 'at_expenses.json';
            toggleLocationButton('at-button');
            updateExpensesTable(currentDisplayedDate);
        });

        document.getElementById('bh-button').addEventListener('click', () => {
            currentExpensesFile = 'bh_expenses.json';
            toggleLocationButton('bh-button');
            updateExpensesTable(currentDisplayedDate);
        });

        // Initial setup
        updateExpensesTable(currentDisplayedDate);
        updateCurrentMonthDisplay(currentDisplayedDate);
    </script>
</body>

</html>
